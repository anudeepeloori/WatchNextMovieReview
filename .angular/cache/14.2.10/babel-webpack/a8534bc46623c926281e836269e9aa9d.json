{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nlet MoviesComponent = class MoviesComponent {\n  constructor(ds, router, hc) {\n    this.ds = ds;\n    this.router = router;\n    this.hc = hc;\n    this.p = 1; // Review data object\n\n    this.reviewData = {\n      userId: \"\",\n      movieId: null,\n      starRating: 0,\n      reviewText: ''\n    };\n  }\n\n  ngOnInit() {\n    // Fetch movie data\n    this.ds.getMoviesData().subscribe(items => {\n      this.movieData = items;\n    }, err => {\n      console.log(\"Error fetching movies\", err);\n    }); // Get logged-in user ID from local storage\n\n    this.userId = localStorage.getItem(\"userId\");\n    this.reviewData.userId = this.userId; // Ensure review data has userId\n  } // Navigate to specific movie details page\n\n\n  onSelectId(id) {\n    this.router.navigateByUrl('movies/' + id);\n  } // Open Review Modal and Fetch Existing Review\n\n\n  openReviewModal(movieId) {\n    this.reviewData.movieId = movieId;\n    this.reviewData.userId = this.userId; // Ensure userId is set\n\n    console.log(\"Opening review modal for movieId:\", movieId); // Fetch existing review if available\n\n    this.ds.getReviewByUserAndMovie(this.userId, movieId).subscribe(res => {\n      if (res) {\n        this.reviewData.starRating = res.rating;\n        this.reviewData.reviewText = res.reviewText;\n      }\n    }, err => {\n      console.log(\"No existing rating found.\");\n    });\n  } // Submit Review (Update if Exists, Otherwise Insert)\n\n\n  onSubmitReview() {\n    if (!this.reviewData.movieId || !this.reviewData.userId) {\n      alert(\"Error: Missing movie or user information.\");\n      return;\n    }\n\n    this.ds.submitReview(this.reviewData).subscribe(res => {\n      console.log(\"Review submitted successfully\", res);\n      alert(res.message);\n    }, err => {\n      console.error(\"Error saving review\", err);\n    });\n  }\n\n};\nMoviesComponent = __decorate([Component({\n  selector: 'app-movies',\n  templateUrl: './movies.component.html',\n  styleUrls: ['./movies.component.css']\n})], MoviesComponent);\nexport { MoviesComponent };","map":null,"metadata":{},"sourceType":"module"}